---
title: "5 XGBoost classification"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, message=FALSE, warning=FALSE}
library(rfintext)
library(rfinstats)
library(dplyr)
library(xgboost)
library(caret)
library(topicmodels)
library(quanteda)
library(doFuture)
plan(multisession)
```


```{r}
aspol_y <- aspol |>
  preprocess_corpus() |>
  left_join(taantuvat)
```

```{r}
dtm <- aspol_y |> corpus_to_dtm(kunta, LEMMA)
```


```{r}
split_data_test <- function(data, variable) {
  y = dplyr::pull(data, {{variable}})
  trainIndex <- caret::createDataPartition(y, p = .8, 
                                           list = FALSE, times = 1)
  
  dataTrain <- data[trainIndex, ]
  dataTest <- data[-trainIndex, ]
  
  list("Train" = dataTrain, "Test" = dataTest)
}
```


```{r}
aspol_data <- split_data_test(aspol_y, luokka)
```

```{r}
dtm
```


```{r}
k_values <- c(2, 6, 9, 16)
lda_dtm <- foreach(k = k_values) %dofuture% {
  rfintext::get_doc_topic_prob(dtm, k = k) |>
    tidytext::cast_dfm(document, topic, gamma)
}
names(lda_dtm) <- paste0("k_", k_values)
```


```{r}
# dtrain <- aspol_data$Train |>
#   corpus_to_dtm(kunta, LEMMA) |>
#   dfm_select(terms(lda6, 25)) |>
#   as.matrix() |>
#   xgb.DMatrix(data = asp, label=train$label)
# 
# dtest <- xgb.DMatrix(data = test$data, label=test$label)
```


```{r}
# bstSparse <- xgboost(data = train$data, label = train$label, max.depth = 2, eta = 1, nthread = 2, nrounds = 2, objective = "binary:logistic")
```



